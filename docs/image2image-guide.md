# 图生图功能说明

本文档详细介绍 AstrBot AI 图像生成插件的图生图功能，帮助您快速掌握使用方法。

## 目录

- [概述](#概述)
- [功能特点](#功能特点)
- [基本用法](#基本用法)
- [参数说明](#参数说明)
- [支持模型](#支持模型)
- [使用示例](#使用示例)
- [提示词技巧](#提示词技巧)
- [参数调优](#参数调优)
- [常见问题](#常见问题)
- [相关文档](#相关文档)

## 概述

图生图功能使用 Gitee AI 的图生图模型，根据您提供的参照图生成相同风格的新图片。通过自然语言描述，可以轻松实现风格迁移、场景转换、细节优化等效果。

## 功能特点

- ✅ **风格迁移**：保持参照图的风格，生成新的内容
- ✅ **场景转换**：在保持风格的同时改变场景
- ✅ **细节优化**：基于参照图优化细节和质感
- ✅ **高质量输出**：生成高质量的图片
- ✅ **参数可调**：支持自定义推理步数和引导系数
- ✅ **快速响应**：优化的 API 调用，快速返回结果

## 基本用法

### 命令格式

```
/ai-gitee image2image <提示词> [steps] [guidance_scale]
```

### 使用步骤

1. **发送参照图片**：选择一张参照图片发送到聊天中
2. **输入命令**：在图片消息后输入图生图命令
3. **等待结果**：AI 处理完成后会返回生成的图片

### 示例

```
[发送一张风景照片]
/ai-gitee image2image 生成一张相同风格的图片
```

## 参数说明

### 提示词（必需）

描述您想要的生成效果，使用自然语言即可。

**示例**：
- `生成一张相同风格的图片`
- `保持人物特征，改变背景为海滩`
- `在保持风格的同时，改变场景为城市`
- `生成一张相似风格的不同图片`

**提示词编写技巧**：
- 📝 使用清晰、具体的描述
- 🎨 描述想要的风格或场景
- 🌄 描述场景或背景变化
- 👤 描述人物特征（如果需要）

### steps（可选）

推理步数，控制生成的精细程度。

- **类型**：整数
- **范围**：1-100
- **默认值**：25（来自配置中的 `image2image_steps`）
- **影响**：
  - 较小的值（10-20）：生成速度快，但细节较少
  - 中等值（20-30）：平衡速度和质量（推荐）
  - 较大的值（30-50）：生成质量高，但速度较慢

**示例**：
```
/ai-gitee image2image 生成一张相同风格的图片 20
```

### guidance_scale（可选）

引导系数，控制生成结果对参照图和提示词的遵循程度。

- **类型**：浮点数
- **范围**：1.0-20.0
- **默认值**：6.0（来自配置中的 `image2image_guidance_scale`）
- **影响**：
  - 较小的值（1.0-5.0）：更自由创作，风格变化较大
  - 中等值（5.0-8.0）：平衡创作和参照（推荐）
  - 较大的值（8.0-15.0）：更严格遵循参照图，风格更接近

**示例**：
```
/ai-gitee image2image 生成一张相同风格的图片 25 7.5
```

**同时指定两个参数**：
```
/ai-gitee image2image 生成一张相同风格的图片 30 7.5
```
- `30`：推理步数
- `7.5`：引导系数

## 支持模型

图生图功能支持以下模型（可在配置中选择）：

| 模型名称 | 说明 |
|---------|------|
| Kolors | 快手开发，中文优化（默认） |
| FLUX.1-Kontext-dev | 上下文感知修改 |
| FLUX.1-Dev | 强大图文理解 |
| HiDream-E1-Full | 精细图像编辑 |

**配置方法**：
在 `_conf_schema.json` 中配置 `image2image_model` 字段。

## 使用示例

### 示例 1：基础图生图

**目标**：根据参照图生成相同风格的图片

**命令**：
```
[发送一张风景照片]
/ai-gitee image2image 生成一张相同风格的图片
```

**预期效果**：
- ✅ 生成的新图片与参照图风格相似
- ✅ 内容不同，但风格一致
- ✅ 整体氛围和色调相似

---

### 示例 2：保持人物特征

**目标**：保持人物特征，改变场景

**命令**：
```
[发送一张人物照片]
/ai-gitee image2image 保持人物特征，改变背景为海滩
```

**预期效果**：
- ✅ 人物面部特征保持相似
- ✅ 背景更换为海滩
- ✅ 整体风格与参照图一致

---

### 示例 3：自定义推理步数

**目标**：使用较少的推理步数快速生成

**命令**：
```
[发送一张风景照片]
/ai-gitee image2image 生成一张相同风格的图片 15
```

**预期效果**：
- ✅ 生成速度更快
- ✅ 风格相似
- ✅ 细节可能略有不足

---

### 示例 4：自定义引导系数

**目标**：更严格地遵循参照图风格

**命令**：
```
[发送一张风景照片]
/ai-gitee image2image 生成一张相同风格的图片 25 10.0
```

**预期效果**：
- ✅ 生成结果更接近参照图
- ✅ 风格更一致
- ✅ 创意性可能降低

---

### 示例 5：场景转换

**目标**：在保持风格的同时改变场景

**命令**：
```
[发送一张城市夜景照片]
/ai-gitee image2image 在保持风格的同时，改变场景为森林
```

**预期效果**：
- ✅ 场景从城市夜景变为森林
- ✅ 保持夜景风格
- ✅ 光线和氛围相似

---

### 示例 6：风格迁移

**目标**：将参照图的风格应用到新内容

**命令**：
```
[发送一张油画风格的照片]
/ai-gitee image2image 生成一张新的油画风格图片
```

**预期效果**：
- ✅ 生成新的图片
- ✅ 保持油画风格
- ✅ 笔触和质感相似

---

## 提示词技巧

### 技巧 1：使用清晰的描述

**模糊描述**：
```
生成一张好看的图片
```

**清晰描述**：
```
生成一张相同风格的风景图片，保持油画质感
```

---

### 技巧 2：描述风格特征

**示例**：
```
生成一张相同风格的图片，保持柔和的光线和温暖的色调
```

```
生成一张相同风格的图片，保持电影感和戏剧性的光线
```

```
生成一张相同风格的图片，保持复古照片的质感
```

---

### 技巧 3：描述场景变化

**示例**：
```
在保持风格的同时，改变场景为海滩
```

```
保持风格，将场景从室内改为室外
```

```
在保持风格的同时，改变季节为秋天
```

---

### 技巧 4：描述人物特征

**示例**：
```
保持人物特征，改变背景为海滩
```

```
保持人物风格，改变服装为正式服装
```

```
保持人物特征，改变场景为城市夜景
```

---

### 技巧 5：组合多个效果

**示例**：
```
保持人物特征，改变背景为海滩，同时保持柔和的光线
```

**示例**：
```
在保持风格的同时，改变场景为森林，并增加电影感
```

---

## 参数调优

### steps 参数调优

**快速生成（速度优先）**：
```
/ai-gitee image2image 生成一张相同风格的图片 10
```
- ✅ 生成速度快
- ⚠️ 细节较少

**平衡生成（推荐）**：
```
/ai-gitee image2image 生成一张相同风格的图片 25
```
- ✅ 速度和质量平衡
- ✅ 适合大多数场景

**高质量生成（质量优先）**：
```
/ai-gitee image2image 生成一张相同风格的图片 40
```
- ✅ 生成质量高
- ⚠️ 生成速度较慢

---

### guidance_scale 参数调优

**自由创作（创意优先）**：
```
/ai-gitee image2image 生成一张相同风格的图片 25 3.0
```
- ✅ 创意性强
- ⚠️ 风格可能变化较大

**平衡创作（推荐）**：
```
/ai-gitee image2image 生成一张相同风格的图片 25 6.0
```
- ✅ 创意和参照平衡
- ✅ 适合大多数场景

**严格遵循（参照优先）**：
```
/ai-gitee image2image 生成一张相同风格的图片 25 12.0
```
- ✅ 风格更接近参照图
- ⚠️ 创意性降低

---

### 参数组合示例

**快速且自由**：
```
/ai-gitee image2image 生成一张相同风格的图片 15 3.0
```

**平衡且平衡**：
```
/ai-gitee image2image 生成一张相同风格的图片 25 6.0
```

**高质量且严格**：
```
/ai-gitee image2image 生成一张相同风格的图片 40 12.0
```

---

## 常见问题

### Q: 图生图需要多长时间？

**A**: 生成时间取决于图片大小、steps 参数和复杂度：
- steps=10-20：通常 10-30 秒
- steps=20-30：通常 30-60 秒（推荐）
- steps=30-50：通常 60-120 秒

### Q: 可以使用哪些类型的参照图？

**A**: 支持大多数常见图片格式：
- ✅ PNG
- ✅ JPG/JPEG
- ✅ WEBP
- ❌ 不支持 GIF（动画）

### Q: 可以同时使用多张参照图吗？

**A**: 目前仅支持单张参照图。如需使用多张图片，请：
1. 选择最重要的一张作为参照图
2. 在提示词中描述其他图片的特征

### Q: 生成效果不理想怎么办？

**A**: 尝试以下方法：
1. 优化提示词，使用更具体的描述
2. 调整 steps 参数（增加以提升质量）
3. 调整 guidance_scale 参数（增加以更接近参照图）
4. 确保参照图质量良好
5. 尝试使用不同的提示词描述

### Q: steps 参数应该设置为多少？

**A**: 推荐设置：
- 📊 快速生成：10-20
- 📊 平衡生成：20-30（推荐）
- 📊 高质量生成：30-50

### Q: guidance_scale 参数应该设置为多少？

**A**: 推荐设置：
- 📊 自由创作：1.0-5.0
- 📊 平衡创作：5.0-8.0（推荐）
- 📊 严格遵循：8.0-15.0

### Q: 图生图和文生图有什么区别？

**A**:
- **文生图（generate）**：使用文本提示词生成图片
- **图生图（image2image）**：使用参照图和文本提示词生成图片，风格更接近参照图

### Q: 图生图和 AI 编辑有什么区别？

**A**:
- **图生图（image2image）**：根据参照图生成新的图片，内容不同但风格相似
- **AI 编辑（ai-edit）**：编辑现有图片，保持内容但改变风格或元素

### Q: 如何获得更好的生成效果？

**A**: 提示词编写建议：
1. 📝 使用清晰、具体的描述
2. 🎨 描述想要的具体效果
3. 🌄 描述场景或背景变化
4. 👤 描述人物特征（如果需要）
5. 🔄 尝试不同的表达方式

### Q: 生成失败怎么办？

**A**: 检查以下几点：
1. 确保发送了参照图片
2. 检查提示词是否为空
3. 检查 API Key 是否有效
4. 检查参数范围（steps: 1-100, guidance_scale: 1.0-20.0）
5. 查看错误日志
6. 尝试重新发送

### Q: 可以连续生成吗？

**A**: 可以！您可以：
1. 使用原始参照图进行第一次生成
2. 使用第一次生成的结果作为参照图进行第二次生成
3. 重复此过程逐步优化

**示例**：
```
[发送参照图]
/ai-gitee image2image 生成一张相同风格的图片

[发送生成的图片]
/ai-gitee image2image 在保持风格的同时，改变场景为森林
```

### Q: 图生图支持哪些效果？

**A**: 支持的效果取决于提示词描述，常见效果包括：
- 🎨 风格迁移
- 🌄 场景转换
- 👤 人物特征保持
- 🎭 整体风格改变
- 🌅 光线和氛围调整

---

## 高级用法

### 组合使用命令

您可以组合使用多个命令来实现复杂效果：

```
# 步骤 1：生成基础图片
/ai-gitee generate 一个可爱的女孩

# 步骤 2：转换为手办风格
[发送上一步生成的图片]
/ai-gitee style 手办化

# 步骤 3：使用图生图生成新图片
[发送上一步生成的图片]
/ai-gitee image2image 生成一张相同风格的不同图片
```

---

### 渐进式生成

逐步优化图片：

```
# 第一次生成
[发送参照图]
/ai-gitee image2image 生成一张相同风格的图片

# 第二次生成（基于第一次生成结果）
[发送生成的图片]
/ai-gitee image2image 在保持风格的同时，改变场景为森林

# 第三次生成（基于第二次生成结果）
[发送生成的图片]
/ai-gitee image2image 在保持风格的同时，改变季节为秋天
```

---

### 批量生成

使用相同的参照图生成多张图片：

```
# 第一次生成
[发送参照图]
/ai-gitee image2image 生成一张相同风格的图片

# 第二次生成（使用相同的参照图）
[发送参照图]
/ai-gitee image2image 生成一张相同风格的不同图片

# 第三次生成（使用相同的参照图）
[发送参照图]
/ai-gitee image2image 在保持风格的同时，改变场景为海滩
```

---

## 最佳实践

### 1. 选择合适的参数

- 📊 **快速生成**：steps=15, guidance_scale=5.0
- 📊 **平衡生成**：steps=25, guidance_scale=6.0（推荐）
- 📊 **高质量生成**：steps=40, guidance_scale=8.0

### 2. 编写清晰的提示词

- ✅ 使用具体、明确的描述
- ✅ 描述想要的具体效果
- ✅ 避免模糊不清的描述

### 3. 使用高质量参照图

- 📷 参照图质量越好，生成效果越好
- 📷 确保图片清晰、光线良好
- 📷 避免模糊、过暗的图片

### 4. 逐步优化

- 🔄 不要期望一次生成就完美
- 🔄 可以多次生成逐步优化
- 🔄 每次生成都基于上一次的结果

### 5. 保存参照图

- 💾 保留参照图备份
- 💾 如不满意，可以重新生成
- 💾 便于对比生成前后的效果

---

## 相关文档

- 📖 [快速开始](getting-started.md) - 安装和配置指南
- ⚙️ [配置说明](configuration.md) - 详细的配置选项
- 📚 [使用指南](user-guide.md) - 指令调用方法
- 📐 [支持的图像尺寸](image-sizes.md) - 尺寸和比例详情
- 🖼️ [出图展示区](examples.md) - 生成示例和提示词技巧
- 🛠️ [故障排除](troubleshooting.md) - 常见问题解决
- ✏️ [AI 编辑功能说明](ai-edit-guide.md) - AI 图片编辑功能

---

## 快速参考

### 常用命令

| 命令 | 说明 |
|------|------|
| `/ai-gitee image2image <提示词>` | 使用默认参数生成 |
| `/ai-gitee image2image <提示词> 20` | 自定义推理步数 |
| `/ai-gitee image2image <提示词> 25 7.5` | 自定义推理步数和引导系数 |

### 常用提示词

| 效果 | 提示词 |
|------|--------|
| 基础生成 | `生成一张相同风格的图片` |
| 保持人物特征 | `保持人物特征，改变背景为海滩` |
| 场景转换 | `在保持风格的同时，改变场景为森林` |
| 风格迁移 | `生成一张新的油画风格图片` |
| 季节变化 | `在保持风格的同时，改变季节为秋天` |

### 参数推荐

| 场景 | steps | guidance_scale |
|------|-------|----------------|
| 快速生成 | 15 | 5.0 |
| 平衡生成（推荐） | 25 | 6.0 |
| 高质量生成 | 40 | 8.0 |

---

希望本文档能帮助您快速掌握图生图功能！如有疑问，请参考相关文档或寻求帮助。🎨✨